(function(){"use strict";let r,w=null;function f(){return(w===null||w.byteLength===0)&&(w=new Uint8Array(r.memory.buffer)),w}function R(e,t){return e=e>>>0,f().subarray(e/1,e/1+t)}function W(e){const t=r.__externref_table_alloc();return r.__wbindgen_export_2.set(t,e),t}function F(e,t){try{return e.apply(this,t)}catch(n){const i=W(n);r.__wbindgen_exn_store(i)}}const p=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&p.decode();function m(e,t){return e=e>>>0,p.decode(f().subarray(e,e+t))}let g=0;function h(e,t){const n=t(e.length*1,1)>>>0;return f().set(e,n/1),g=e.length,n}function l(e){const t=r.__wbindgen_export_2.get(e);return r.__externref_table_dealloc(e),t}const b=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},k=typeof b.encodeInto=="function"?function(e,t){return b.encodeInto(e,t)}:function(e,t){const n=b.encode(e);return t.set(n),{read:e.length,written:n.length}};function z(e,t,n){if(n===void 0){const o=b.encode(e),_=t(o.length,1)>>>0;return f().subarray(_,_+o.length).set(o),g=o.length,_}let i=e.length,a=t(i,1)>>>0;const c=f();let s=0;for(;s<i;s++){const o=e.charCodeAt(s);if(o>127)break;c[a+s]=o}if(s!==i){s!==0&&(e=e.slice(s)),a=n(a,i,i=s+e.length*3,1)>>>0;const o=f().subarray(a+s,a+i),_=k(e,o);s+=_.written,a=n(a,i,s,1)>>>0}return g=s,a}const x=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_wasmlanguagegenerator_free(e>>>0,1));class d{static __wrap(t){t=t>>>0;const n=Object.create(d.prototype);return n.__wbg_ptr=t,x.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,x.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_wasmlanguagegenerator_free(t,0)}next_token(){const t=r.wasmlanguagegenerator_next_token(this.__wbg_ptr);if(t[2])throw l(t[1]);return String.fromCodePoint(t[0])}}const T=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>r.__wbg_wasmlanguagemodel_free(e>>>0,1));class u{static __wrap(t){t=t>>>0;const n=Object.create(u.prototype);return n.__wbg_ptr=t,T.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,T.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_wasmlanguagemodel_free(t,0)}static bigram(t){const n=h(t,r.__wbindgen_malloc),i=g,a=r.wasmlanguagemodel_bigram(n,i);if(a[2])throw l(a[1]);return u.__wrap(a[0])}static transformer(t,n,i,a,c,s){const o=h(s,r.__wbindgen_malloc),_=g,y=r.wasmlanguagemodel_transformer(t,n,i,a,c,o,_);if(y[2])throw l(y[1]);return u.__wrap(y[0])}create_generator(t,n,i){const a=z(i,r.__wbindgen_malloc,r.__wbindgen_realloc),c=g,s=r.wasmlanguagemodel_create_generator(this.__wbg_ptr,t,n,a,c);if(s[2])throw l(s[1]);return d.__wrap(s[0])}}async function U(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(i){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",i);else throw i}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function M(){const e={};return e.wbg={},e.wbg.__wbg_getRandomValues_3c9c0d586e575a16=function(){return F(function(t,n){globalThis.crypto.getRandomValues(R(t,n))},arguments)},e.wbg.__wbindgen_error_new=function(t,n){return new Error(m(t,n))},e.wbg.__wbindgen_init_externref_table=function(){const t=r.__wbindgen_export_2,n=t.grow(4);t.set(0,void 0),t.set(n+0,void 0),t.set(n+1,null),t.set(n+2,!0),t.set(n+3,!1)},e.wbg.__wbindgen_throw=function(t,n){throw new Error(m(t,n))},e}function O(e,t){return r=e.exports,A.__wbindgen_wasm_module=t,w=null,r.__wbindgen_start(),r}async function A(e){if(r!==void 0)return r;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof e>"u"&&(e=new URL("/makemore-fun/assets/web_bg-Db551_ki.wasm",self.location.href));const t=M();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:i}=await U(await e,t);return O(n,i)}async function S(e){const t=e.model;await A();const n=await fetch(t.url),i=new Uint8Array(await n.arrayBuffer()),a=j(i,t);let c=e.initialContext;const s=a.create_generator(BigInt(Date.now()),e.temperature,c);for(let o=0;o<e.chars;o++)c+=s.next_token(),E({type:"output",text:c});E({type:"done"})}function j(e,t){switch(t.type){case"bigram":return u.bigram(e);case"transformer":return u.transformer(t.n_embed,t.block_size,t.num_layers,t.num_heads,0,e)}}onmessage=async e=>{e.data.type==="generate"&&S(e.data)};function E(e){postMessage(e)}})();
